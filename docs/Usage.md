# Usage Guide

**VBAlidator** is a command-line tool designed to statically analyze VBA code exported from Microsoft Office applications. It simulates the compilation process to detect syntax errors, undefined variables, and type mismatches without requiring the Windows environment.

## Installation

### Prerequisites
- Python 3.8 or higher
- Pip (Python Package Manager)

### Setup
1. Clone the repository:
   ```bash
   git clone https://github.com/twobeass/VBAlidator.git
   cd VBAlidator
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

## Running the Tool

VBAlidator is executed as a Python module.

```bash
python -m src.main [options] <input_folder>
```

### Arguments

| Argument | Description |
| :--- | :--- |
| `input_folder` | **Required.** Positional argument. Path to the directory containing your exported `.bas`, `.cls`, and `.frm` files. |
| `-h, --help` | Show help message and exit. |
| `--define` | Conditional Compilation constants. Format: `KEY=VALUE,KEY2=True`. |
| `--model` | Path to a custom JSON Object Model file. Merges with the standard library. |
| `--output` | Path to save the structured JSON report (default: `vba_report.json`). |

### Examples

#### Basic Check
Check all files in the `export` folder.
```bash
python -m src.main ./export
```

#### Conditional Compilation
Simulate a 64-bit environment.
```bash
python -m src.main ./export --define "Win64=True,VBA7=True"
```

#### Custom Object Model
Use a specific object model definition generated by the exporter.
```bash
python -m src.main ./export --model ./vba_model.json
```

### Running the Demo
A `demo/` folder is included to showcase the tool's capabilities. It contains files with intentional errors.

```bash
python -m src.main ./demo
```

Expected output includes:
*   Undefined variables (`x`, `unknown_var`)
*   Duplicate declarations (`Dim y`)
*   Invalid constant initialization (`Const InvalidConst = UndefinedConstant`)
*   Invalid procedure calls (`res = z(10)`)
*   Missing members (`Me.InvalidMethod`, `i.SomeMethod`)

### What is NOT Covered
While VBAlidator is a powerful static analysis tool, it is not a full VBA compiler. Some compile-time and run-time errors may not be detected:

*   **Late Binding:** Calls to objects declared as `Object` or `Variant` are not validated.
*   **Complex Flow Analysis:** Uninitialized variables (used before assignment) or complex `GoTo` logic (jumping into blocks) are not fully analyzed.
*   **Runtime Logic:** Errors like "Division by zero" or "Index out of bounds" are runtime errors and are outside the scope of static analysis.

## Output

The tool provides two types of output:

1.  **Console Output:** Colored logs indicating the file, line number, and error message.
    ```
    Module1.bas:10: Undefined identifier 'MyVar' in 'MySub'.
    ```

2.  **JSON Report:** A machine-readable report saved to the specified output path.
    ```json
    {
      "summary": {
        "files_scanned": 5,
        "issues_found": 1
      },
      "issues": [
        {
          "file": "Module1.bas",
          "line": 10,
          "message": "Undefined identifier 'MyVar' in 'MySub'."
        }
      ]
    }
    ```
